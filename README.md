# 群报告 - HTML转可访问网页工具

这是一个将HTML代码转换为可访问网页的工具，用户可以上传或粘贴HTML代码，系统会自动部署为可在多端设备访问的网页。

## 功能特点

- 支持HTML代码上传或粘贴
- 自动部署为可访问网页
- 生成独立访问链接
- 适配多端设备显示
- 使用Cloudflare R2进行云存储
- 通过Vercel进行应用部署

## 技术栈

### 核心依赖

- Next.js: 14.2.3（稳定版）
- React: 18.2.0
- React DOM: 18.2.0
- TailwindCSS: 3.4.3
- TypeScript: ^5.x

### 开发依赖

- ESLint: ^8.57.0（与Next.js 14.2.3兼容）
- PostCSS: 8.4.38
- Autoprefixer: 10.4.16

> **注意**：我们特意选择使用 Next.js 14.2.3 稳定版而不是 Next.js 15.x，这是因为：
> 1. Next.js 15.x 的 Turbopack 仍处于实验阶段
> 2. lightningcss 在 Next.js 15.x 中可能存在兼容性问题
> 3. 为了确保生产环境的稳定性，我们优先选择经过充分测试的稳定版本

### 云服务

- 存储：Cloudflare R2
- 部署：Vercel

## 开发环境设置

1. 克隆项目

```bash
git clone https://github.com/your-username/qunbaogao.git
cd qunbaogao
```

2. 安装依赖

```bash
npm install
```

3. 配置环境变量

复制`env.sample`文件为`.env.local`，并填入相应的配置信息：

```bash
cp env.sample .env.local
```

4. 启动开发服务器

```bash
npm run dev
```

访问 [http://localhost:3000](http://localhost:3000) 查看应用。

## Cloudflare R2 配置

1. 在Cloudflare控制台创建R2存储桶
2. 创建API密钥，获取Access Key ID和Secret Access Key
3. 配置CORS策略允许从应用域名访问

## 部署到Vercel

1. 将代码推送到GitHub仓库
2. 在Vercel中导入GitHub项目
3. 配置环境变量
4. 完成部署后，可绑定自定义域名qunbaogao.com

## 许可证

[MIT](LICENSE)

---

## 近期开发规划与讨论 (截至 2025-05-28)

**历史已完成**：

*   **链接策略调整** (已完成代码和部署测试)
    *   统一URL路径为 `/api/view/[filename]`。
    *   复选框功能调整为"为此链接设置密码 (可选)"。
*   **"报告集"功能 MVP (已更名为：知识库)** (已完成基础功能)
    *   支持多文件上传创建知识库。
    *   使用 Supabase 存储元数据，文件存储于 R2。
    *   实现知识库访问路由 `/view-set/[setId]`，包含侧边栏导航和 iframe 内容展示。
    *   支持知识库级别密码保护。

**近期更新 (2025-05-29)**:

### 1. 知识库功能优化 (已完成)

*   **侧边栏UI优化**:
    *   侧边栏（背景、文字、选中项）颜色调整为更低调的银灰色系 (slate)。
    *   侧边栏增加折叠/展开按钮（使用 Heroicons 的 `Bars3Icon` 和 `ChevronLeftIcon`），并添加过渡动画。
    *   侧边栏底部"返回首页"链接文本更新为"返回群报告"。
*   **文件列表排序图标优化**:
    *   `HtmlUploader.tsx` 中，调整文件顺序的上下箭头替换为 Heroicons 的 `ArrowUpCircleIcon` 和 `ArrowDownCircleIcon`。
*   **文本表述优化** (部分已由用户自行完成):
    *   `HtmlUploader.tsx`: "为此知识库设置密码" → "设置访问密码"。
    *   `HtmlUploader.tsx`: 密码输入框 placeholder 根据上下文更新为 "请输入知识库访问密码" 或 "请输入访问密码"。
    *   （用户已自行完成大量其他文本优化）。
*   **知识库搜索功能 (初步)**:
    *   在知识库查看页面的侧边栏添加了搜索框。
    *   **当前实现**: 仅支持按"文件名"进行搜索和过滤。
    *   搜索框 placeholder 已更新为 "按文件名搜索..." 以明确当前搜索范围。

### 2. 知识库内容搜索 (规划与探讨中)

*   **当前局限性**: 当前搜索功能无法搜索 HTML 文件内部的实际内容。
*   **中期方案探讨**: 考虑优化后端 API (`/api/get-set-details/[setId]`)，在创建知识库时提取每个 HTML 文件的"高频关键词"（需进行分词和停用词处理），并将这些关键词与文件元数据一同存储和返回。前端搜索时将同时匹配文件名和这些提取的关键词。
    *   **优点**: 比仅搜索文件名更进一步，可能捕获用户关心的核心内容点。
    *   **挑战**: 涉及后端分词库引入、词频统计逻辑、关键词质量控制等。
*   **长期方案设想**: 实现更完善的后端内容索引和搜索机制。

### 3. UI/UX 体验优化 (持续进行中)

*   **"复制链接"提示框**: 当前使用浏览器原生 `alert()`。未来可考虑替换为自定义的 Toast/Notification 组件，以实现位置（如居中显示）、样式和交互的完全控制。

### 4. "报告集"功能 MVP (规划中，下一步核心特性)

**目标**: 允许用户一次性上传多个相关的HTML文件（例如，多天的群聊日报），系统将生成一个单一的、可分享的"报告集"链接。用户访问此链接后，可以看到一个带有侧边栏导航的页面，通过点击导航（使用原始文件名作为标签）切换显示不同的HTML报告内容。

**核心实现思路**:

- **多文件上传**: 前端UI将支持用户选择并上传多个HTML文件。
- **后端处理与存储**:
  - **元数据存储**: 将使用 **Supabase** 数据库来管理报告集及其包含的文件的元数据。
    - `report_sets` 表: 存储报告集信息 (ID, 标题, 可选的整个报告集密码等)。
    - `report_files` 表: 存储报告集内每个文件的信息 (ID, 所属报告集ID, 标签/文件名, R2存储路径, 在集内的顺序等)。
  - **文件存储**: 每个HTML文件仍独立上传到 Cloudflare R2，其路径将包含报告集的ID (例如 `report_sets/[set_id]/[original_filename].html`)。
- **报告集访问路由**: 新增一个路由，例如 `https://qunbaogao.com/view-set/[set_id]`。
  - 访问此路由时，后端将从Supabase查询该报告集的文件列表。
  - 如果报告集设置了密码，则先进行密码验证。
  - 动态生成一个"外壳"HTML页面，包含：
    - 左侧（或顶部）导航栏：根据文件列表生成，标签为文件名。
    - 右侧内容区：使用 `<iframe>` 来加载和显示选定HTML文件的内容。HTML文件将通过现有的 `/api/view/...` 路径加载 (路径需能处理嵌套，如 `/api/view/report_sets/[set_id]/[filename].html`)。
- **密码策略**: 为整个"报告集"设置一个可选密码。单个HTML文件的密码设置功能（在上传单个文件时）将继续保留。

**用户体验考量**:

- **编辑/追加**: 借助Supabase，未来可以较容易地实现向现有报告集追加新文件、删除文件或重新排序文件的功能。
- **简单搜索 (MVP后考虑)**: 初期报告集不包含搜索功能。未来可首先考虑在报告集导航页内实现简单的前端内容搜索。

**关于用户注册与匿名使用**:

- **当前功能 (包括即将开发的报告集MVP)**: 初步规划为无需用户注册即可使用，以降低使用门槛。
- **编辑/追加报告集**: 若要实现非注册用户也能编辑/追加自己创建的报告集，可能需要一种机制来"认领"或管理匿名创建的内容（例如，在创建时提供一个一次性的管理链接，或基于浏览器本地存储等）。如果希望有更稳健的长期管理，用户注册会是更可靠的方案。此部分细节待后续深入设计。

```bash
npm install --save-dev aws-sdk mock-aws-s3 nock
```
