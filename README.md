# 群报告 - HTML转可访问网页工具

这是一个将HTML代码转换为可访问网页的工具，用户可以上传或粘贴HTML代码，系统会自动部署为可在多端设备访问的网页。

## 功能特点

- 支持HTML代码上传或粘贴
- 自动部署为可访问网页
- 生成独立访问链接
- 适配多端设备显示
- 使用Cloudflare R2进行云存储
- 通过Vercel进行应用部署

## 技术栈

### 核心依赖

- Next.js: 14.2.3（稳定版）
- React: 18.2.0
- React DOM: 18.2.0
- TailwindCSS: 3.4.3
- TypeScript: ^5.x

### 开发依赖

- ESLint: ^8.57.0（与Next.js 14.2.3兼容）
- PostCSS: 8.4.38
- Autoprefixer: 10.4.16

> **注意**：我们特意选择使用 Next.js 14.2.3 稳定版而不是 Next.js 15.x，这是因为：
> 1. Next.js 15.x 的 Turbopack 仍处于实验阶段
> 2. lightningcss 在 Next.js 15.x 中可能存在兼容性问题
> 3. 为了确保生产环境的稳定性，我们优先选择经过充分测试的稳定版本

### 云服务

- 存储：Cloudflare R2
- 部署：Vercel

## 开发环境设置

1. 克隆项目

```bash
git clone https://github.com/your-username/qunbaogao.git
cd qunbaogao
```

2. 安装依赖

```bash
npm install
```

3. 配置环境变量

复制`env.sample`文件为`.env.local`，并填入相应的配置信息：

```bash
cp env.sample .env.local
```

4. 启动开发服务器

```bash
npm run dev
```

访问 [http://localhost:3000](http://localhost:3000) 查看应用。

## Cloudflare R2 配置

1. 在Cloudflare控制台创建R2存储桶
2. 创建API密钥，获取Access Key ID和Secret Access Key
3. 配置CORS策略允许从应用域名访问

## 部署到Vercel

1. 将代码推送到GitHub仓库
2. 在Vercel中导入GitHub项目
3. 配置环境变量
4. 完成部署后，可绑定自定义域名qunbaogao.com

## 许可证

[MIT](LICENSE)

---

## 近期开发规划与讨论 (截至 2025-05-28)

### 1. 链接策略调整 (已完成代码和部署测试)

- **统一URL路径**: 所有通过本工具生成的链接都将采用 `https://qunbaogao.com/api/view/[filename]` 的格式。这确保了品牌一致性，并为未来的功能扩展（如统计、高级权限控制）保留了服务器端控制点。
- **复选框功能变更**: 前端部署界面上的复选框（原"生成私有链接"）功能已调整为"为此链接设置密码 (可选)"。
  - 如果不勾选或勾选但未填写密码，生成的 `/api/view/...` 链接将是公开可访问的（通过应用服务器代理访问R2内容）。
  - 如果勾选并填写密码，生成的 `/api/view/...` 链接将受密码保护。

### 2. "报告集"功能 MVP (规划中，下一步核心特性)

**目标**: 允许用户一次性上传多个相关的HTML文件（例如，多天的群聊日报），系统将生成一个单一的、可分享的"报告集"链接。用户访问此链接后，可以看到一个带有侧边栏导航的页面，通过点击导航（使用原始文件名作为标签）切换显示不同的HTML报告内容。

**核心实现思路**:

- **多文件上传**: 前端UI将支持用户选择并上传多个HTML文件。
- **后端处理与存储**:
  - **元数据存储**: 将使用 **Supabase** 数据库来管理报告集及其包含的文件的元数据。
    - `report_sets` 表: 存储报告集信息 (ID, 标题, 可选的整个报告集密码等)。
    - `report_files` 表: 存储报告集内每个文件的信息 (ID, 所属报告集ID, 标签/文件名, R2存储路径, 在集内的顺序等)。
  - **文件存储**: 每个HTML文件仍独立上传到 Cloudflare R2，其路径将包含报告集的ID (例如 `report_sets/[set_id]/[original_filename].html`)。
- **报告集访问路由**: 新增一个路由，例如 `https://qunbaogao.com/view-set/[set_id]`。
  - 访问此路由时，后端将从Supabase查询该报告集的文件列表。
  - 如果报告集设置了密码，则先进行密码验证。
  - 动态生成一个"外壳"HTML页面，包含：
    - 左侧（或顶部）导航栏：根据文件列表生成，标签为文件名。
    - 右侧内容区：使用 `<iframe>` 来加载和显示选定HTML文件的内容。HTML文件将通过现有的 `/api/view/...` 路径加载 (路径需能处理嵌套，如 `/api/view/report_sets/[set_id]/[filename].html`)。
- **密码策略**: 为整个"报告集"设置一个可选密码。单个HTML文件的密码设置功能（在上传单个文件时）将继续保留。

**用户体验考量**:

- **编辑/追加**: 借助Supabase，未来可以较容易地实现向现有报告集追加新文件、删除文件或重新排序文件的功能。
- **简单搜索 (MVP后考虑)**: 初期报告集不包含搜索功能。未来可首先考虑在报告集导航页内实现简单的前端内容搜索。

**关于用户注册与匿名使用**:

- **当前功能 (包括即将开发的报告集MVP)**: 初步规划为无需用户注册即可使用，以降低使用门槛。
- **编辑/追加报告集**: 若要实现非注册用户也能编辑/追加自己创建的报告集，可能需要一种机制来"认领"或管理匿名创建的内容（例如，在创建时提供一个一次性的管理链接，或基于浏览器本地存储等）。如果希望有更稳健的长期管理，用户注册会是更可靠的方案。此部分细节待后续深入设计。
